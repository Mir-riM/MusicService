# Music Service (TatarMusic)

Пет-проект с музыкальным сервисом.

Изначально проект не планировался для публикации на GitHub, поэтому история коммитов начинается не с самого начала.

Проект в активной разработке. Функциональность и архитектура могут изменяться.

---

## Запуск

```bash
# Через Docker (рекомендуется)
docker compose up --build

# Вручную (нужны запущенные MinIO и MongoDB)
npm run dev  # в корне или в client/server по отдельности
```

После старта:

- **Клиент:** http://localhost:3000  
- **API:** http://localhost:4000  
- **MinIO Console:** http://localhost:9001 (логин/пароль из `docker-compose.yml`)

Бакеты MinIO (`tracks`, `pictures`, `playlists`) создаются автоматически при первом запуске сервера и делаются публичными для чтения.

---

## Полный функционал сайта

### Авторизация

- Регистрация и вход по логину/паролю.
- JWT: access- и refresh-токены в httpOnly cookies.
- Выход (очистка cookies и редирект на страницу входа).
- В навбаре отображаются логин и кнопка «Выйти» (или «Войти» для гостя).

### Треки

- **Главная:** список свежих треков и популярных плейлистов, общий поиск по трекам и плейлистам (один поиск, две секции результатов).
- **Страница «Треки»:** полный список треков с пагинацией (без поиска — поиск только на главной).
- **Страница трека:** прослушивание, обложка, автор, текст, счётчик прослушиваний; лайк; комментарии (один комментарий от пользователя на трек, редактирование/удаление только своего).
- **Загрузка трека:** только для авторизованных; загрузка аудио и обложки.
- **Загруженные треки:** отдельная страница только для авторизованных — список треков, загруженных текущим пользователем, пагинация, кнопка «Добавить трек» (переход на страницу загрузки). В навбаре пункт «Загруженные треки» виден только после входа; пункта «Добавить трек» в меню нет (доступ через «Загруженные треки»).
- **Удаление трека:** только владелец или модератор/админ.
- **Прослушивания:** учёт на сервере после прослушивания не менее половины трека (на клиенте считаются реально прослушанные секунды, без учёта перемотки).
- **Лайки:** понравившиеся треки в разделе «Коллекции» с пагинацией.

### Плейлисты

- **Создание:** только авторизованные; название, обложка, публичный/приватный.
- **Приватные плейлисты:** не показываются в поиске, в «Популярных» и в любых публичных подборках; по прямой ссылке доступны только владельцу — для остальных и гостей API возвращает 404.
- **Популярные плейлисты:** на главной отображаются только публичные (или свои приватные для владельца), сортировка по числу подписчиков.
- **Поиск плейлистов:** глобальный поиск на главной ищет и треки, и плейлисты по имени; в выдаче плейлистов — только публичные (плюс свои для авторизованного).
- **Страница плейлиста:** треки с пагинацией; кнопки «Подписаться»/«Отписаться» (статус подписки с сервера); счётчик подписчиков; форк; для владельца — редактирование и удаление (с подтверждением).
- **Коллекции:** раздел только для авторизованных — «Понравившиеся» (треки) и «Плейлисты» (подписки пользователя) с пагинацией; создание плейлиста; отображение числа подписчиков у плейлистов.

### Плеер

- Воспроизведение, пауза, следующий/предыдущий трек.
- **Режим повторения:** выключен / повтор плейлиста / повтор одного трека (переключение кнопкой в плеере).
- Прогресс и перемотка; громкость.
- Учёт прослушивания при прослушанной половине трека (по реальному времени воспроизведения).

### Прочее

- Подтверждение перед удалением трека, плейлиста, комментария и перед форком плейлиста.
- Валидация DTO на бэкенде (class-validator); доступ к изменению/удалению по владельцу или ролям (admin/moderator где применимо).
- Пагинация: треки (все, поиск, понравившиеся, загруженные), плейлисты (подписки, популярные, поиск), треки внутри плейлиста.

---

## Технологии

### Frontend

- Next.js (App Router)
- Material UI, Tailwind CSS
- Redux Toolkit, RTK Query
- React Hook Form, Zod
- Notistack (уведомления)

### Backend

- NestJS
- Passport JWT, Guards (в т.ч. опциональный JWT для публичных маршрутов с учётом пользователя)
- class-validator / class-transformer
- MongoDB (Mongoose), MinIO (S3-совместимый API)

### Инфраструктура

- Docker Compose: frontend (Next.js), backend (NestJS), MongoDB, MinIO.
- Сервер при старте создаёт в MinIO бакеты `tracks`, `pictures`, `playlists` (если их ещё нет) и выставляет для них политику публичного чтения.

---

## Планы

- Добавление **тестов** (unit/e2e).
- **Документация API** через Swagger.

---

## Статус

Проект в активной разработке.
